<html>
	<head>
		<style type="text/css">
      body {
        background: #ddd;
      }
      form {
        float:right;
      }
      .hat {
        height: 25px;
        background: #999;
        padding: 5px;
        margin-bottom: 10px;
      }
      .hat label { 
        color: #fff;
      }
      .hat a {
        color: #eee;
      }
      .hat #message {
        margin-left: 10px;
      }
      .hat #message.success {
        color: green;
      }
      .hat #message.fail {
        color: #c00;
      }
		</style>
		<title>Content Editable</title>
	</head>
	<body>
    <div class="hat">
      <input id="filename" name="filename" placeholder="Note Name"/>
  		<a href="#" id="save">save</a>
      <a href="#" id="new">new</a>
      <span id="message"></span>
      <form id="form_editables" name="form_editables">
        <select id="editables"><option>choose an old editable</option></select>
        <input type="submit" value="Load" />
      </form>
    </div>
		<div id="content" contenteditable></div>

    <script>
      var form = document.getElementById("form_editables");
      var editable_select = document.getElementById("editables");
      var content = document.getElementById("content");
      var filename = document.getElementById("filename");
      var saved = false;

      content.addEventListener("onkeypress", function() {
        saved = false;
      });

      content.style.height= window.innerHeight - 100;

      for (var key in localStorage){
        if(key.indexOf("_editables") > 0) {
          var option=document.createElement("option");
          name = key.substring(0,key.indexOf("_editables"));
          option.text = name;
          option.value = name;
          editable_select.add(option,null);
        }
      }

      window.onresize = function(event) { 
        content.style.height= window.innerHeight - 100;
      }
      
      form.addEventListener("submit", function(e) {
        e.preventDefault();
        if(content.innerHTML == "") {
          load_editable();
        } else if(confirm("Loading new content will replace the content in the editable area. Are you sure you want to do this?")) {
          load_editable();
        }
      });

      document.getElementById("save").addEventListener("click", function () {
        if(filename.value != "") {
          localStorage.setItem(filename.value + "_editables", content.innerHTML);
          saved = true;
          say(filename.value + " saved", "success")          
        } else {
          say("You need to name your note for it to be saved");
        }
      });

      document.getElementById("new").addEventListener("click", function() {
        if(saved || content.innerHTML != "" && confirm("You'll loose any changes you've made that are unsaved! Are you sure?")) {
          content.innerHTML = "";
          editable_select.selectedIndex = 0;
        }
      });

      function load_editable() {
        var key = editable_select.options[editable_select.selectedIndex].text;
        filename.value = key;
        content.innerHTML = localStorage.getItem(key + "_editables");
      }

      function say(m,color) {
        var e = document.getElementById("message");
        e.innerHTML = m;
        e.className = color == "success" ? "success" : "fail";
        setTimeout( function(){
          e.innerHTML = "";
        },5000);
      }
    </script>
	</body>
</html>